---

# AI Context Menu Sender (Background Script)

Этот скрипт является «мозгом» расширения для браузера Chrome, которое позволяет мгновенно отправлять выделенный текст с любой веб-страницы в популярные чат-боты на базе ИИ через контекстное меню.

## Основные функции

*   **Интеграция в контекстное меню:** Добавляет пункт "Отправить в AI" в меню правой кнопки мыши при выделении текста.
*   **Поддержка множества платформ:** Прямая отправка текста в:
    *   Grok (x.ai)
    *   ChatGPT (OpenAI)
    *   Google Gemini
    *   DeepSeek
    *   Kimi AI
    *   Z.ai
    *   Qwen AI (Alibaba Cloud)
*   **Специальные команды:** Наличие функции «Send and translate to Qwen», которая автоматически добавляет промпт для перевода выделенного текста на русский язык.
*   **Умное управление окнами:** 
    *   Если вкладка с нужным ИИ уже открыта, расширение переключается на неё и вставляет текст.
    *   Если вкладка отсутствует, создается новое всплывающее окно (`popup`) оптимального размера.
*   **Автоматизация ввода:** Скрипт интеллектуально находит поле ввода (textarea или contenteditable div) на целевом сайте, фокусируется на нем, вставляет текст и эмулирует события ввода (`input`, `change`) для корректной работы веб-интерфейсов ИИ.

## Технические особенности

*   **Универсальные вставки:** Для сложных интерфейсов (ChatGPT, Gemini, Kimi) используется метод `document.execCommand('insertText')`, что обеспечивает совместимость с современными фреймворками (React/Next.js).
*   **Ожидание загрузки (Polling):** Скрипт включает механизм ожидания появления элемента ввода в DOM (до 10-15 секунд), что гарантирует вставку даже при медленной загрузке страницы ИИ-ассистента.
*   **Manifest V3:** Скрипт написан с использованием современного API расширений Chrome (`chrome.scripting`, `chrome.windows`, `chrome.tabs`).

## Как это работает

1.  Пользователь выделяет текст на странице.
2.  Выбирает в контекстном меню нужного ИИ-ассистента.
3.  Скрипт проверяет наличие открытой вкладки с этим ИИ.
4.  Скрипт выполняет инъекцию функции (например, `insertTextToChatGPT`) в контекст целевой страницы.
5.  Выделенный текст автоматически появляется в поле ввода чат-бота, готовый к отправке.

## Использование в разработке

Для работы скрипта в файле `manifest.json` должны быть указаны следующие разрешения:
*   `contextMenus`
*   `tabs`
*   `scripting`
*   `windows`
*   Host permissions для всех перечисленных в коде доменов (grok.com, chatgpt.com, gemini.google.com и т.д.).

---